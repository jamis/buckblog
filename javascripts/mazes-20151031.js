window.require=function(b){var c=arguments.callee;if(!c._cache){c._cache={}}var a=c._cache;if(!a[b]){a[b]=c[b]()}return a[b]};require["algorithm/aldous_broder"]=function(){var a=require("utility");AldousBroder=function(){};AldousBroder.prototype.run=function(b,e){cell=e||b.sample();var c=b.size()-1;cell._abVisited=true;while(c>0){var d=a.sample(cell.neighbors());if(!d._abVisited){cell.link(d);d._abVisited=true;c--}cell=d}};return{Algorithm:AldousBroder}};require["algorithm/binary_tree"]=function(){var a=require("utility");BinaryTree=function(b){this.directions=b};BinaryTree.prototype.run=function(c){var b=this;c.each(function(d){var g=[];for(var e=0;e<b.directions.length;e++){var h=d.neighbor[b.directions[e]];if(h){g.push(h)}}if(g.length>0){var f=a.sample(g);d.link(f)}})};return{Algorithm:BinaryTree}};require["algorithm/recursive_backtracker"]=function(){var a=require("utility");RecursiveBacktracker=function(){};RecursiveBacktracker.prototype.run=function(f,i){i=i||f.sample();var b=[i];var d=this;while(b.length>0){var h=b[b.length-1];var e=h.neighbors();var c=a.select(h.neighbors(),function(j){return j.links().length==0});if(c.length==0){b.pop()}else{var g=a.sample(c);h.link(g);b.push(g)}}};return{Algorithm:RecursiveBacktracker}};require.cell=function(){var a=require("utility");var c=function(d){this.location=d;this.neighbor={};this._links={};this.data={}};c.prototype.linkOne=function(d){this._links[d.location.key]=d};c.prototype.unlinkOne=function(d){delete this._links[d.location.key]};c.prototype.link=function(d){this.linkOne(d);d.linkOne(this)};c.prototype.isDeadEnd=function(){return this.links().length==1};c.prototype.links=function(){var e=[];for(var d in this._links){e.push(this._links[d])}return e};c.prototype.unlink=function(d){this.unlinkOne(d);d.unlinkOne(this)};c.prototype.isLinked=function(d){if(!d){return false}return !!this._links[d.location.key]};c.prototype.isOpen=function(){return this.links().length>0};c.prototype.neighbors=function(){var d=[];for(var e in this.neighbor){d.push(this.neighbor[e])}return d};c.prototype.neighborDirections=function(){if(Object.keys){return Object.keys(this.neighbor)}else{var d=[];for(var e in this.neighbor){d.push(e)}return d}};function b(d){c.call(this,d);this.isCarved=false}b.prototype=new c();b.prototype.constructor=b;b.prototype.link=function(d){if(this.neighbors().indexOf(d)<0){return}this.isCarved=true;d.isCarved=true};b.prototype.unlink=function(d){if(this.neighbors().indexOf(d)<0){return}d.isCarved=false};b.prototype.links=function(){return a.select(this.neighbors(),function(d){return d.isCarved})};b.prototype.isLinked=function(d){return d&&d.isCarved&&this.isCarved&&(this.neighbors().indexOf(d)>=0)};b.prototype.isOpen=function(){return this.isCarved};return{Cell:c,Block:b}};require["geometry/line"]=function(){Line=function(d,c,e){this.a=d;this.b=c;this.style=e};Line.prototype.render=function(a){this.style.apply(a);a.beginPath();a.moveTo(this.a.x,this.a.y);a.lineTo(this.b.x,this.b.y);a.stroke()};Line.prototype.hasPoint=function(b){var c=(this.b.x-this.a.x);var d=(this.b.y-this.a.y);if(c==0){return Math.abs(b.x-this.b.x)<0.00001}else{if(d==0){return Math.abs(b.y-this.b.y)<0.00001}}var a=(b.x-this.a.x)/c;var e=(b.y-this.a.y)/d;return Math.abs(a-e)<0.00001};Line.prototype.tryMerge=function(c){if(!c.a){return null}if(this.style!=c.style){return null}var b=[this.a,this.b];var a=[c.a,c.b];if(this.a.isEqual(c.a)){b=[this.b,this.a]}else{if(this.b.isEqual(c.a)){}else{if(this.a.isEqual(c.b)){b=[this.b,this.a];a=[c.b,c.a]}else{if(this.b.isEqual(c.b)){a=[c.b,c.a]}else{return null}}}}if(!this.hasPoint(a[1])){return null}return new Line(b[0],a[1])};return{Line:Line}};require["geometry/orthogonal/blocks"]=function(){Point=require("geometry/point").Point;Polygon=require("geometry/polygon").Polygon;Style=require("geometry/style").Style;Blocks=function(c,f,e){f=f||1;e=e||{};this.grid=c;this.layers=[];var d=e.block;var b=e.floor;this.min=new Point(1000000,1000000);this.max=new Point(-1000000,-1000000);if(!d){d=new Style();d.strokeStyle="gray";d.fillStyle="black"}var a=this;c.each(function(q){var k=q.location.world;var g=q.location.level;var r=q.location.row;var h=q.location.column;if(!a.layers[k]){a.layers[k]=[]}if(!a.layers[k][g]){a.layers[k][g]=[[],[]]}var l=new Point(h*f,r*f);var i=new Point((h+1)*f,r*f);var p=new Point(h*f,(r+1)*f);var n=new Point((h+1)*f,(r+1)*f);if(l.x<a.min.x){a.min.x=l.x}if(l.y<a.min.y){a.min.y=l.y}if(n.x>a.max.x){a.max.x=n.x}if(n.y>a.max.y){a.max.y=n.y}var m=a.layers[k][g][0];var o=q.style||b;var j=q.style||d;if(q.isOpen()){if(o){m.push(new Polygon([l,i,n,p],o))}}else{m.push(new Polygon([l,i,n,p],j))}})};return{Blocks:Blocks}};require["geometry/orthogonal/blockwise"]=function(){Point=require("geometry/point").Point;Polygon=require("geometry/polygon").Polygon;Style=require("geometry/style").Style;Blockwise=function(a,e,o){e=e||1;o=o||{};this.grid=a;this.layers=[];var k=o.block;var b=o.floor;this.min=new Point(0,0);this.max=new Point(e*(a.layout.columns+1),e*(a.layout.rows+1));if(!k){k=new Style();k.strokeStyle="gray";k.fillStyle="black"}var n=e*0.5;for(var h=0;h<a.layout.worlds;h++){this.layers[h]=[];for(var c=0;c<a.layout.levels;c++){this.layers[h][c]=[[]];var j=this.layers[h][c][0];for(var p=0;p<a.layout.rows*2+1;p++){var g=new Point(0,p*n);var f=new Point(n,p*n);var l=new Point(0,(p+1)*n);var i=new Point(n,(p+1)*n);j.push(new Polygon([g,f,i,l],k))}for(var d=0;d<a.layout.columns*2+1;d++){var g=new Point(d*n,0);var f=new Point((d+1)*n,0);var l=new Point(d*n,n);var i=new Point((d+1)*n,n);j.push(new Polygon([g,f,i,l],k))}}}var m=this;a.each(function(r){var y=r.location.world;var q=r.location.level;var v=r.location.row;var s=r.location.column;var J=new Point(n+s*e,n+v*e);var I=new Point(n+(s+0.5)*e,n+v*e);var G=new Point(n+(s+1)*e,n+v*e);var F=new Point(n+s*e,n+(v+0.5)*e);var D=new Point(n+(s+0.5)*e,n+(v+0.5)*e);var C=new Point(n+(s+1)*e,n+(v+0.5)*e);var B=new Point(n+s*e,n+(v+1)*e);var A=new Point(n+(s+0.5)*e,n+(v+1)*e);var z=new Point(n+(s+1)*e,n+(v+1)*e);var E=m.layers[y][q][0];var w=r.style||b;var t=r.style||k;var H=[J,I,D,F];var u=[I,G,C,D];var x=[F,D,A,B];var K=[D,C,z,A];if(w){E.push(new Polygon(H,w))}E.push(new Polygon(K,t));if(r.isLinked(r.neighbor.south)){if(w){E.push(new Polygon(x,w))}}else{E.push(new Polygon(x,t))}if(r.isLinked(r.neighbor.east)){if(w){E.push(new Polygon(u,w))}}else{E.push(new Polygon(u,t))}})};return{Blockwise:Blockwise}};require["geometry/orthogonal/outlines"]=function(){Point=require("geometry/point").Point;Line=require("geometry/line").Line;Polygon=require("geometry/polygon").Polygon;Style=require("geometry/style").Style;Outlines=function(c,f,d){f=f||1;d=d||{};if(typeof f!="object"){f={x:f,y:f}}this.grid=c;this.layers=[];var a=d.wall;var e=d.cell;this.min=new Point(1000000,1000000);this.max=new Point(-1000000,-1000000);if(!a){a=new Style();a.strokeStyle="black"}if(!e){e=new Style();e.fillStyle="transparent";e.strokeStyle="transparent"}var b=this;c.each(function(p){var k=p.location.world;var g=p.location.level;var q=p.location.row;var i=p.location.column;if(!b.layers[k]){b.layers[k]=[]}if(!b.layers[k][g]){b.layers[k][g]=[[],[]]}var l=new Point(i*f.x,q*f.y);var j=new Point((i+1)*f.x,q*f.y);var o=new Point(i*f.x,(q+1)*f.y);var n=new Point((i+1)*f.x,(q+1)*f.y);if(l.x<b.min.x){b.min.x=l.x}if(l.y<b.min.y){b.min.y=l.y}if(n.x>b.max.x){b.max.x=n.x}if(n.y>b.max.y){b.max.y=n.y}var h=p.data.polyStyle||e;var m=p.data.wallStyle||a;b.layers[k][g][0].push(new Polygon([l,j,n,o],h));if(!p.neighbor.north){b.layers[k][g][1].push(new Line(l,j,m))}if(!p.neighbor.west){b.layers[k][g][1].push(new Line(l,o,m))}if(!p.isLinked(p.neighbor.south)){b.layers[k][g][1].push(new Line(o,n,m))}if(!p.isLinked(p.neighbor.east)){b.layers[k][g][1].push(new Line(j,n,m))}})};return{Outlines:Outlines}};require["geometry/orthogonal/paths"]=function(){Point=require("geometry/point").Point;Line=require("geometry/line").Line;Style=require("geometry/style").Style;Paths=function(b,e,c){e=e||1;c=c||{};if(typeof e!="object"){e={x:e,y:e}}this.grid=b;this.layers=[];var d=c.path;this.min=new Point(1000000,1000000);this.max=new Point(-1000000,-1000000);if(!d){d=new Style();d.strokeStyle="black"}var a=this;b.each(function(m){var h=m.location.world;var f=m.location.level;var n=m.location.row;var g=m.location.column;if(!a.layers[h]){a.layers[h]=[]}if(!a.layers[h][f]){a.layers[h][f]=[[]]}var l=new Point((g+0.5)*e.x,(n+0.5)*e.y);var j=new Point((g+0.5)*e.x,(n+1.5)*e.y);var k=new Point((g+1.5)*e.x,(n+0.5)*e.y);if(l.x<a.min.x){a.min.x=l.x}if(l.y<a.min.y){a.min.y=l.y}if(l.x>a.max.x){a.max.x=l.x}if(l.y>a.max.y){a.max.y=l.y}var i=m.data.wallStyle||d;if(m.isLinked(m.neighbor.south)){a.layers[h][f][0].push(new Line(l,j,i))}if(m.isLinked(m.neighbor.east)){a.layers[h][f][0].push(new Line(l,k,i))}})};return{Paths:Paths}};require["geometry/point"]=function(){var a=0.00001;Point=function(b,c){this.x=b;this.y=c};Point.prototype.isEqual=function(c){var b=Math.abs(c.x-b);var d=Math.abs(c.y-d);return(b<a)&&(d<a)};return{Point:Point}};require["geometry/polygon"]=function(){Polygon=function(b,a){this.points=b;this.style=a};Polygon.prototype.render=function(a){this.style.apply(a);a.beginPath();for(var b=0;b<this.points.length;b++){if(b==0){a.moveTo(this.points[b].x,this.points[b].y)}else{a.lineTo(this.points[b].x,this.points[b].y)}}a.closePath();a.fill();a.stroke()};Polygon.prototype.tryMerge=function(a){if(!a.points){return null}if(this.style!=a.style){return null}return null};return{Polygon:Polygon}};require["geometry/style"]=function(){Style=function(a){this.parent=a};Style.prototype.apply=function(a){if(this.parent){this.parent.apply(a)}if(this.fillStyle){a.fillStyle=this.fillStyle}if(this.strokeStyle){a.strokeStyle=this.strokeStyle}if(this.shadowColor){a.shadowColor=this.shadowColor}if(this.shadowBlur){a.shadowBlur=this.shadowBlur}if(this.shadowOffsetX){a.shadowOffsetX=this.shadowOffsetX}if(this.shadowOffsetY){a.shadowOffsetY=this.shadowOffsetY}if(this.lineCap){a.lineCap=this.lineCap}if(this.lineJoin){a.lineJoin=this.lineJoin}if(this.lineWidth){a.lineWidth=this.lineWidth}if(this.miterLimit){a.miterLimit=this.miterLimit}};return{Style:Style}};require.grid=function(){_=require("utility");Grid=function(a,b){this._cells=[];this._lookup={};this.layout=a;a.build(this,b)};Grid.prototype.addCell=function(a){this._cells.push(a);this._lookup[a.location.key]=a;return this};Grid.prototype.size=function(){return this._cells.length};Grid.prototype.at=function(a){return this._lookup[a.key]};Grid.prototype.sample=function(){return _.sample(this._cells)};Grid.prototype.deadends=function(){var a=[];this.each(function(b){if(b.isDeadEnd()){a.push(b)}});return a};Grid.prototype.braid=function(f){f=f||0.5;var e=_.shuffle(this.deadends());var d=Math.floor(e.length*f);for(var c=0;c<d;c++){var a=e[c];if(a.links().length>1){continue}var b=_.reject(a.neighbors(),function(g){return a.isLinked(g)});a.link(_.sample(b))}};Grid.prototype.each=function(b){for(var a=0;a<this._cells.length;a++){b(this._cells[a])}return this};Grid.prototype.select=function(a){var c=[];if(typeof a!=="function"){var b=a;a=function(d){return d.location.match(b)}}this.each(function(d){if(a(d)){c.push(d)}});return c};return{Grid:Grid}};require["layout/orthogonal"]=function(){Location=require("location/lattice").Location;Orthogonal=function(){var a=arguments.length-1;this.columns=arguments[a];this.rows=arguments[a-1];this.levels=arguments[a-2]||1;this.worlds=arguments[a-3]||1};Orthogonal.location=function(){switch(arguments.length){case 2:return new Location(arguments[0],arguments[1]);case 3:return new Location(arguments[0],arguments[1],arguments[2]);case 4:return new Location(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw"wrong # of arguments"}};Orthogonal.prototype.build=function(b,j){j=j||require("cell").Cell;for(var f=0;f<this.worlds;f++){for(var c=0;c<this.levels;c++){for(var l=0;l<this.rows;l++){for(var d=0;d<this.columns;d++){var g=new Location(f,c,l,d);var k=new j(g);var a=b.at(g.change({world:-1}));var i=b.at(g.change({level:-1}));var e=b.at(g.change({row:-1}));var h=b.at(g.change({column:-1}));if(a){k.neighbor.hither=a;a.neighbor.yon=k}if(i){k.neighbor.down=i;i.neighbor.up=k}if(e){k.neighbor.north=e;e.neighbor.south=k}if(h){k.neighbor.west=h;h.neighbor.east=k}b.addCell(k)}}}}};return{Layout:Orthogonal}};require["location/lattice"]=function(){Location=function(){var a=arguments.length-1;this.column=arguments[a];this.row=arguments[a-1];this.level=arguments[a-2]||0;this.world=arguments[a-3]||0;this.key="w"+this.world+"l"+this.level+"r"+this.row+"c"+this.column};Location.prototype.match=function(a){var b=function(e,d){if(typeof d==="undefined"){return true}if(typeof d!=="function"){var c;if(typeof d!=="object"){c={from:parseInt(d),to:parseInt(d),except:[]}}else{c={from:d.from||0,to:d.to||Infinity,except:d.except||[]}}d=function(f){if(f<c.from){return false}if(f>c.to){return false}if(c.except.indexOf(f)>=0){return false}return true}}return d(e)};return b(this.world,a.world)&&b(this.level,a.level)&&b(this.row,a.row)&&b(this.column,a.column)};Location.prototype.change=function(a){var c=this.world+(a.world||0);var e=this.level+(a.level||0);var d=this.row+(a.row||0);var b=this.column+(a.column||0);return new Location(c,e,d,b)};return{Location:Location}};require.prng=function(){var a=function(b){if(b==undefined){b=new Date().getTime()}this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;this.init_genrand(b)};a.prototype.init_genrand=function(b){this.mt[0]=b>>>0;for(this.mti=1;this.mti<this.N;this.mti++){var b=this.mt[this.mti-1]^(this.mt[this.mti-1]>>>30);this.mt[this.mti]=(((((b&4294901760)>>>16)*1812433253)<<16)+(b&65535)*1812433253)+this.mti;this.mt[this.mti]>>>=0}};a.prototype.genrand_int32=function(){var d;var c=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var b;if(this.mti==this.N+1){this.init_genrand(5489)}for(b=0;b<this.N-this.M;b++){d=(this.mt[b]&this.UPPER_MASK)|(this.mt[b+1]&this.LOWER_MASK);this.mt[b]=this.mt[b+this.M]^(d>>>1)^c[d&1]}for(;b<this.N-1;b++){d=(this.mt[b]&this.UPPER_MASK)|(this.mt[b+1]&this.LOWER_MASK);this.mt[b]=this.mt[b+(this.M-this.N)]^(d>>>1)^c[d&1]}d=(this.mt[this.N-1]&this.UPPER_MASK)|(this.mt[0]&this.LOWER_MASK);this.mt[this.N-1]=this.mt[this.M-1]^(d>>>1)^c[d&1];this.mti=0}d=this.mt[this.mti++];d^=(d>>>11);d^=(d<<7)&2636928640;d^=(d<<15)&4022730752;d^=(d>>>18);return d>>>0};a.prototype.random=function(){if(arguments.length>0){return this.genrand_int32()%arguments[0]}else{return this.genrand_int32()*(1/4294967296)}};a.prototype.flipCoin=function(){return(this.random(2)==0)};return{PRNG:a}};require.utility=function(){var e=require("prng").PRNG;var b=new e();function d(k){b=new e(k);return k}function a(l,k){if(!l){return b.random()}if(!k){k=l;l=0}return l+b.random(k-l)}function g(k){return k[a(k.length)]}function c(n){for(var m=0;m<n.length-1;m++){var l=a(m+1,n.length);var k=n[m];n[m]=n[l];n[l]=k}return n}function h(n,m){if(n.filter){return n.filter(m)}else{var l=[];for(var k=0;k<n.length;k++){if(m(n[k])){l.push(n[k])}}return l}}function j(l,k){return h(l,function(m){return !k(m)})}function f(m,l){for(var k=0;k<m.length;k++){if(l(m[k])==false){break}}return m}function i(m,l){for(var k=0;k<m.length;k++){if(l(m[k])==false){return false}}return true}return{all:i,each:f,srand:d,random:a,reject:j,sample:g,select:h,shuffle:c,prng:b}};